wt(admin side)

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Smart Event Scheduler — Admin</title>

    <!-- Bootstrap 5 & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --sidebar-w: 260px;
        --accent: #0d6efd;
        --dark-accent: #002b80;
      }
      body {
        font-family: Poppins, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: #f5f7fb;
        margin: 0;
      }
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: var(--sidebar-w);
        background: linear-gradient(180deg, var(--accent), var(--dark-accent));
        color: #fff;
        padding: 1.25rem 0;
        overflow: auto;
      }
      .sidebar .brand {
        font-weight: 700;
        font-size: 1.05rem;
        text-align: center;
        padding-bottom: 1rem;
      }
      .sidebar a {
        display: block;
        color: rgba(255, 255, 255, 0.92);
        padding: 0.6rem 1.25rem;
        text-decoration: none;
        border-left: 4px solid transparent;
      }
      .sidebar a:hover,
      .sidebar a.active {
        background: rgba(255, 255, 255, 0.06);
        border-left-color: #fff;
      }
      .main {
        margin-left: var(--sidebar-w);
        padding: 1.5rem;
      }
      .card {
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(13, 38, 88, 0.06);
        border: none;
      }
      .btn-primary {
        background: linear-gradient(90deg, var(--accent), #0052cc);
        border: none;
      }
      .summary-card {
        display: flex;
        gap: 1rem;
        align-items: center;
        padding: 1rem;
      }
      .summary-card img {
        width: 48px;
        height: 48px;
      }
      .event-img,
      .user-avatar {
        width: 56px;
        height: 56px;
        object-fit: cover;
        border-radius: 8px;
      }
      .small-muted {
        font-size: 0.85rem;
        color: #6c757d;
      }
      .nav-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .hidden {
        display: none;
      }
      .table thead {
        background: #f1f4f9;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .calendar-cell {
        min-height: 90px;
        background: #fff;
        border-radius: 8px;
        padding: 6px;
        box-shadow: 0 2px 8px rgba(12, 38, 89, 0.04);
      }
      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 4px;
      }
      .reports-stat {
        display: flex;
        gap: 1rem;
        align-items: center;
        justify-content: space-between;
      }
      /* responsive */
      @media (max-width: 900px) {
        :root {
          --sidebar-w: 200px;
        }
        .main {
          padding: 1rem;
        }
        .event-img,
        .user-avatar {
          width: 44px;
          height: 44px;
        }
      }
    </style>
  </head>
  <body>
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="brand">Smart Event Scheduler — Admin</div>
      <nav>
        <a href="#" data-view="dashboard" class="active"
          ><i class="bi bi-speedometer2 me-2"></i> Dashboard</a
        >
        <a href="#" data-view="events"
          ><i class="bi bi-calendar-event me-2"></i> Events</a
        >
        <a href="#" data-view="add-event"
          ><i class="bi bi-plus-circle me-2"></i> Add Event</a
        >
        <a href="#" data-view="calendar"
          ><i class="bi bi-calendar3 me-2"></i> Calendar</a
        >
        <a href="#" data-view="users"
          ><i class="bi bi-people me-2"></i> Users</a
        >
        <a href="#" data-view="add-user"
          ><i class="bi bi-person-plus me-2"></i> Add User</a
        >
        <a href="#" data-view="notifications"
          ><i class="bi bi-bell me-2"></i> Notifications</a
        >
        <a href="#" data-view="reports"
          ><i class="bi bi-bar-chart-line me-2"></i> Reports</a
        >
        <a href="#" data-view="settings"
          ><i class="bi bi-gear me-2"></i> Settings</a
        >
        <a href="#" data-view="help"
          ><i class="bi bi-question-circle me-2"></i> Help / About</a
        >
      </nav>
      <div style="padding: 1rem">
        <small class="small-muted">Logged in as</small>
        <div style="font-weight: 700; margin-top: 0.25rem">Admin</div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main container-fluid">
      <div id="view-dashboard" class="view">
        <div class="nav-top">
          <h3 class="mb-0">Dashboard</h3>
          <div>
            <button class="btn btn-outline-secondary me-2" id="refreshBtn">
              <i class="bi bi-arrow-repeat"></i> Refresh
            </button>
            <button
              class="btn btn-primary"
              data-view="add-event"
              id="quickAddBtn"
            >
              <i class="bi bi-plus-lg"></i> Add Event
            </button>
          </div>
        </div>

        <!-- summary -->
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <div class="card p-3 summary-card">
              <img
                src="https://cdn-icons-png.flaticon.com/512/869/869869.png"
                alt=""
              />
              <div>
                <div class="small-muted">Total Events</div>
                <h4 id="statEvents">0</h4>
                <div class="small-muted">
                  Upcoming in next 30 days: <span id="upcoming30">0</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card p-3 summary-card">
              <img
                src="https://cdn-icons-png.flaticon.com/512/1256/1256650.png"
                alt=""
              />
              <div>
                <div class="small-muted">Users</div>
                <h4 id="statUsers">0</h4>
                <div class="small-muted">
                  Active users: <strong id="activeUsers">0</strong>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card p-3 summary-card">
              <img
                src="https://cdn-icons-png.flaticon.com/512/2463/2463510.png"
                alt=""
              />
              <div>
                <div class="small-muted">Reminders Sent</div>
                <h4 id="statReminders">0</h4>
                <div class="small-muted">
                  Pending notifications: <span id="pendingNotifs">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- upcoming events -->
        <div class="card p-3 mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Upcoming Events</h5>
            <small class="small-muted">Sorted by date</small>
          </div>
          <div class="table-responsive">
            <table class="table align-middle" id="tbl-upcoming">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Image</th>
                  <th>Event</th>
                  <th>Date</th>
                  <th>Location</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- EVENTS PAGE -->
      <div id="view-events" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Events</h3>
          <div>
            <button class="btn btn-primary me-2" data-view="add-event">
              <i class="bi bi-plus-circle"></i> Add Event
            </button>
            <button class="btn btn-outline-secondary" id="exportEvents">
              Export JSON
            </button>
          </div>
        </div>

        <div class="card p-3">
          <div class="table-responsive">
            <table class="table" id="tbl-events">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Date</th>
                  <th>Location</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADD EVENT PAGE -->
      <div id="view-add-event" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Add Event</h3>
          <div>
            <button class="btn btn-secondary" data-view="events">
              <i class="bi bi-arrow-left"></i> Back to Events
            </button>
          </div>
        </div>

        <div class="card p-4">
          <form id="formAddEvent" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Event Name</label>
                <input class="form-control" id="e_name" required />
                <div class="invalid-feedback">Enter event name</div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" id="e_date" required />
                <div class="invalid-feedback">Select date</div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Time</label>
                <input type="time" class="form-control" id="e_time" />
              </div>
              <div class="col-12">
                <label class="form-label">Location</label>
                <input class="form-control" id="e_location" required />
                <div class="invalid-feedback">Enter location</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Upload Image</label>
                <input
                  type="file"
                  accept="image/*"
                  class="form-control"
                  id="e_image"
                />
                <img
                  id="e_preview"
                  class="mt-2"
                  style="max-width: 140px; display: none; border-radius: 8px"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label">Description</label>
                <textarea id="e_desc" class="form-control" rows="4"></textarea>
              </div>
              <div class="col-12 text-end">
                <button
                  class="btn btn-secondary me-2"
                  type="button"
                  data-view="events"
                >
                  Cancel
                </button>
                <button class="btn btn-primary" id="btnSaveEvent" type="button">
                  Save Event
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- CALENDAR PAGE -->
      <div id="view-calendar" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Calendar</h3>
          <div>
            <button class="btn btn-outline-secondary" id="prevMonth">
              <i class="bi bi-chevron-left"></i>
            </button>
            <span class="mx-2" id="calMonthLabel"></span>
            <button class="btn btn-outline-secondary" id="nextMonth">
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="card p-3">
          <div class="calendar-grid" id="calendarGrid">
            <!-- cells generated by JS -->
          </div>
        </div>
      </div>

      <!-- USERS PAGE -->
      <div id="view-users" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Users</h3>
          <div>
            <button class="btn btn-primary" data-view="add-user">
              <i class="bi bi-person-plus"></i> Add User
            </button>
          </div>
        </div>

        <div class="card p-3">
          <div class="table-responsive">
            <table class="table" id="tbl-users">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Avatar</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADD USER PAGE -->
      <div id="view-add-user" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Add User</h3>
          <div>
            <button class="btn btn-secondary" data-view="users">
              <i class="bi bi-arrow-left"></i> Back
            </button>
          </div>
        </div>
        <div class="card p-3">
          <form id="formAddUser" novalidate>
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Full name</label>
                <input class="form-control" id="u_name" required />
                <div class="invalid-feedback">Enter name</div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="u_email"
                  required
                />
                <div class="invalid-feedback">Enter a valid email</div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Role</label>
                <select class="form-select" id="u_role">
                  <option>Admin</option>
                  <option>Editor</option>
                  <option>Viewer</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Avatar</label>
                <input
                  type="file"
                  accept="image/*"
                  class="form-control"
                  id="u_avatar"
                />
                <img
                  id="u_preview"
                  class="mt-2"
                  style="max-width: 120px; display: none; border-radius: 8px"
                />
              </div>
              <div class="col-12 text-end">
                <button
                  class="btn btn-secondary"
                  type="button"
                  data-view="users"
                >
                  Cancel
                </button>
                <button class="btn btn-primary" id="btnSaveUser" type="button">
                  Save User
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- NOTIFICATIONS PAGE -->
      <div id="view-notifications" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Notifications</h3>
          <div>
            <button class="btn btn-primary" id="btnSendNotif">
              <i class="bi bi-envelope-plus"></i> Send
            </button>
          </div>
        </div>

        <div class="row g-3">
          <div class="col-md-7">
            <div class="card p-3">
              <h6>Notification Center</h6>
              <ul id="notifList" class="list-group list-group-flush mt-2"></ul>
            </div>
          </div>
          <div class="col-md-5">
            <div class="card p-3">
              <h6>Send Quick Notification</h6>
              <div class="mb-2">
                <input
                  id="notif_title"
                  class="form-control"
                  placeholder="Title"
                />
              </div>
              <div class="mb-2">
                <textarea
                  id="notif_msg"
                  class="form-control"
                  rows="4"
                  placeholder="Message"
                ></textarea>
              </div>
              <div class="text-end">
                <button class="btn btn-primary" id="sendQuickNotif">
                  Send
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- REPORTS PAGE -->
      <div id="view-reports" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Reports</h3>
          <div>
            <button class="btn btn-outline-secondary" id="btnRefreshReports">
              Refresh
            </button>
          </div>
        </div>

        <div class="card p-3">
          <div class="reports-stat mb-3">
            <div>
              <h5>Events by Month</h5>
              <small class="small-muted">Simple counts for last 6 months</small>
            </div>
            <div id="reportSummary" style="min-width: 220px; text-align: right">
              <div>Total events: <strong id="reportTotal">0</strong></div>
              <div>Users: <strong id="reportUsers">0</strong></div>
            </div>
          </div>

          <div id="reportsContainer"></div>
        </div>
      </div>

      <!-- SETTINGS PAGE -->
      <div id="view-settings" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Settings</h3>
          <div></div>
        </div>

        <div class="card p-3">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Admin Name</label>
              <input id="setting_admin" class="form-control" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Dashboard Theme</label>
              <select id="setting_theme" class="form-select">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>
            <div class="col-12 text-end">
              <button class="btn btn-primary" id="btnSaveSettings">
                Save Settings
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- HELP PAGE -->
      <div id="view-help" class="view hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Help / About</h3>
          <div></div>
        </div>

        <div class="card p-3">
          <h5>Smart Event Scheduler</h5>
          <p class="small-muted">
            A Web-Based Event Planning and Reminder System — Admin Panel demo.
            Use the sidebar to navigate pages. Events and Users persist locally
            using localStorage.
          </p>
          <h6>Shortcuts</h6>
          <ul>
            <li>Quick Add: Add event from Dashboard</li>
            <li>Export events as JSON using Export button on Events page</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- BOOTSTRAP JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      /* ---------------------------
  Simple SPA + Local Storage
   - stores events & users as arrays in localStorage
   - images are saved as dataURLs
----------------------------*/
      const views = document.querySelectorAll(".view");
      const navLinks = document.querySelectorAll(".sidebar a");
      const main = document.querySelector(".main");

      function showView(name) {
        views.forEach((v) =>
          v.id === "view-" + name
            ? v.classList.remove("hidden")
            : v.classList.add("hidden")
        );
        navLinks.forEach((a) =>
          a.dataset.view === name
            ? a.classList.add("active")
            : a.classList.remove("active")
        );
        // if special hooks
        if (name === "dashboard") renderDashboard();
        if (name === "events") renderEvents();
        if (name === "users") renderUsers();
        if (name === "calendar") renderCalendar();
        if (name === "reports") renderReports();
        if (name === "notifications") renderNotifications();
        if (name === "settings") loadSettings();
      }
      navLinks.forEach((a) =>
        a.addEventListener("click", (e) => {
          e.preventDefault();
          showView(a.dataset.view);
        })
      );
      // quick data access
      let STORAGE_EVENTS = "ses_events_v1";
      let STORAGE_USERS = "ses_users_v1";
      let STORAGE_NOTIF = "ses_notif_v1";
      let STORAGE_SETTINGS = "ses_settings_v1";

      // initial sample data if none
      function seedIfEmpty() {
        if (!localStorage.getItem(STORAGE_EVENTS)) {
          const sample = [
            {
              id: 1,
              name: "Tech Meetup",
              date: "2025-10-15",
              time: "18:00",
              location: "Main Hall",
              desc: "Monthly tech meetup",
              img: "https://cdn-icons-png.flaticon.com/512/1027/1027100.png",
            },
          ];
          localStorage.setItem(STORAGE_EVENTS, JSON.stringify(sample));
        }
        if (!localStorage.getItem(STORAGE_USERS)) {
          const us = [
            {
              id: 1,
              name: "Alice Admin",
              email: "alice@org.com",
              role: "Admin",
              avatar: "https://cdn-icons-png.flaticon.com/512/147/147144.png",
            },
          ];
          localStorage.setItem(STORAGE_USERS, JSON.stringify(us));
        }
        if (!localStorage.getItem(STORAGE_NOTIF)) {
          const n = [
            {
              id: 1,
              title: "Welcome",
              msg: "Welcome to Smart Event Scheduler",
              ts: Date.now(),
            },
          ];
          localStorage.setItem(STORAGE_NOTIF, JSON.stringify(n));
        }
        if (!localStorage.getItem(STORAGE_SETTINGS)) {
          localStorage.setItem(
            STORAGE_SETTINGS,
            JSON.stringify({ adminName: "Admin", theme: "light" })
          );
        }
      }
      seedIfEmpty();

      /* helpers */
      function getEvents() {
        return JSON.parse(localStorage.getItem(STORAGE_EVENTS) || "[]");
      }
      function setEvents(arr) {
        localStorage.setItem(STORAGE_EVENTS, JSON.stringify(arr));
      }
      function getUsers() {
        return JSON.parse(localStorage.getItem(STORAGE_USERS) || "[]");
      }
      function setUsers(arr) {
        localStorage.setItem(STORAGE_USERS, JSON.stringify(arr));
      }
      function getNotifs() {
        return JSON.parse(localStorage.getItem(STORAGE_NOTIF) || "[]");
      }
      function setNotifs(arr) {
        localStorage.setItem(STORAGE_NOTIF, JSON.stringify(arr));
      }
      function getSettings() {
        return JSON.parse(localStorage.getItem(STORAGE_SETTINGS) || "{}");
      }
      function setSettings(o) {
        localStorage.setItem(STORAGE_SETTINGS, JSON.stringify(o));
      }

      /* NAV helpers - buttons with data-view */
      document.querySelectorAll("[data-view]").forEach((el) => {
        el.addEventListener("click", (e) => {
          const v = el.getAttribute("data-view");
          if (v) {
            e.preventDefault();
            showView(v);
          }
        });
      });

      /* DASHBOARD rendering */
      function renderDashboard() {
        const events = getEvents().sort(
          (a, b) => new Date(a.date) - new Date(b.date)
        );
        const users = getUsers();
        const notifs = getNotifs();
        document.getElementById("statEvents").textContent = events.length;
        document.getElementById("statUsers").textContent = users.length;
        document.getElementById("statReminders").textContent = notifs.length;
        // upcoming 30 days
        const now = new Date();
        const in30 = events.filter((ev) => {
          const d = new Date(ev.date);
          const diff = (d - now) / (1000 * 60 * 60 * 24);
          return diff >= 0 && diff <= 30;
        });
        document.getElementById("upcoming30").textContent = in30.length;
        // upcoming table
        const tbody = document.querySelector("#tbl-upcoming tbody");
        tbody.innerHTML = "";
        events.slice(0, 10).forEach((ev, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td>${idx + 1}</td>
      <td><img src="${ev.img || ""}" alt="" class="event-img"></td>
      <td>${ev.name}</td>
      <td>${ev.date}${ev.time ? " • " + ev.time : ""}</td>
      <td>${ev.location || ""}</td>
      <td><button class="btn btn-sm btn-outline-danger btn-delete-event" data-id="${
        ev.id
      }"><i class="bi bi-trash"></i></button></td>
    `;
          tbody.appendChild(tr);
        });
      }

      /* EVENTS page rendering */
      function renderEvents() {
        const events = getEvents().sort(
          (a, b) => new Date(a.date) - new Date(b.date)
        );
        const tbody = document.querySelector("#tbl-events tbody");
        tbody.innerHTML = "";
        events.forEach((ev) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td>${ev.id}</td>
      <td><img src="${ev.img || ""}" class="event-img"></td>
      <td><strong>${ev.name}</strong><div class="small-muted">${(
            ev.desc || ""
          ).slice(0, 70)}</div></td>
      <td>${ev.date}${ev.time ? " • " + ev.time : ""}</td>
      <td>${ev.location || ""}</td>
      <td>
        <button class="btn btn-sm btn-outline-secondary me-1 btn-edit-event" data-id="${
          ev.id
        }"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-sm btn-outline-danger btn-delete-event" data-id="${
          ev.id
        }"><i class="bi bi-trash"></i></button>
      </td>
    `;
          tbody.appendChild(tr);
        });
      }

      /* Add Event page actions */
      document.getElementById("e_image").addEventListener("change", (e) => {
        const f = e.target.files[0];
        if (!f) return;
        const img = document.getElementById("e_preview");
        img.src = URL.createObjectURL(f);
        img.style.display = "block";
      });
      document
        .getElementById("btnSaveEvent")
        .addEventListener("click", async () => {
          const form = document.getElementById("formAddEvent");
          if (!form.checkValidity()) {
            form.classList.add("was-validated");
            return;
          }
          // read image as base64 if provided
          const file = document.getElementById("e_image").files[0];
          let dataUrl = "";
          if (file) {
            dataUrl = await fileToDataUrl(file);
          }
          const events = getEvents();
          const id =
            (events.length ? Math.max(...events.map((x) => x.id)) : 0) + 1;
          const ev = {
            id,
            name: document.getElementById("e_name").value.trim(),
            date: document.getElementById("e_date").value,
            time: document.getElementById("e_time").value,
            location: document.getElementById("e_location").value.trim(),
            desc: document.getElementById("e_desc").value.trim(),
            img:
              dataUrl ||
              "https://cdn-icons-png.flaticon.com/512/1027/1027100.png",
          };
          events.push(ev);
          setEvents(events);
          // reset form
          form.reset();
          document.getElementById("e_preview").style.display = "none";
          alert("Event saved");
          showView("events");
        });

      /* EVENTS delete/edit via delegation */
      document.addEventListener("click", function (e) {
        if (e.target.closest(".btn-delete-event")) {
          const id = +e.target.closest("[data-id]")?.dataset?.id;
          if (!id) return;
          if (!confirm("Delete this event?")) return;
          let evs = getEvents().filter((x) => x.id !== id);
          setEvents(evs);
          renderEvents();
          renderDashboard();
          renderCalendar();
        }
        if (e.target.closest(".btn-edit-event")) {
          const id = +e.target.closest("[data-id]").dataset.id;
          const ev = getEvents().find((x) => x.id === id);
          if (!ev) return;
          // prefill Add Event page with data
          showView("add-event");
          document.getElementById("e_name").value = ev.name;
          document.getElementById("e_date").value = ev.date;
          document.getElementById("e_time").value = ev.time || "";
          document.getElementById("e_location").value = ev.location || "";
          document.getElementById("e_desc").value = ev.desc || "";
          if (ev.img) {
            document.getElementById("e_preview").src = ev.img;
            document.getElementById("e_preview").style.display = "block";
          }
          // On save, we'll overwrite if id exists - simple approach: delete old id before save
          // modify save handler to check for editing
          document.getElementById("btnSaveEvent").onclick = async function () {
            const form = document.getElementById("formAddEvent");
            if (!form.checkValidity()) {
              form.classList.add("was-validated");
              return;
            }
            const file = document.getElementById("e_image").files[0];
            let dataUrl = ev.img;
            if (file) dataUrl = await fileToDataUrl(file);
            // update event
            let events = getEvents().map((x) =>
              x.id === ev.id
                ? {
                    ...x,
                    name: document.getElementById("e_name").value.trim(),
                    date: document.getElementById("e_date").value,
                    time: document.getElementById("e_time").value,
                    location: document
                      .getElementById("e_location")
                      .value.trim(),
                    desc: document.getElementById("e_desc").value.trim(),
                    img: dataUrl,
                  }
                : x
            );
            setEvents(events);
            form.reset();
            document.getElementById("e_preview").style.display = "none";
            alert("Event updated");
            // restore original listener
            restoreEventSaveHandler();
            showView("events");
          };
        }
      });

      /* restore default save handler for adding fresh events */
      function restoreEventSaveHandler() {
        document.getElementById("btnSaveEvent").onclick = async function () {
          const form = document.getElementById("formAddEvent");
          if (!form.checkValidity()) {
            form.classList.add("was-validated");
            return;
          }
          const file = document.getElementById("e_image").files[0];
          let dataUrl = "";
          if (file) dataUrl = await fileToDataUrl(file);
          const events = getEvents();
          const id =
            (events.length ? Math.max(...events.map((x) => x.id)) : 0) + 1;
          const ev = {
            id,
            name: document.getElementById("e_name").value.trim(),
            date: document.getElementById("e_date").value,
            time: document.getElementById("e_time").value,
            location: document.getElementById("e_location").value.trim(),
            desc: document.getElementById("e_desc").value.trim(),
            img:
              dataUrl ||
              "https://cdn-icons-png.flaticon.com/512/1027/1027100.png",
          };
          events.push(ev);
          setEvents(events);
          form.reset();
          document.getElementById("e_preview").style.display = "none";
          alert("Event saved");
          showView("events");
        };
      }
      restoreEventSaveHandler();

      /* USERS */
      document.getElementById("u_avatar").addEventListener("change", (e) => {
        const f = e.target.files[0];
        if (!f) return;
        const img = document.getElementById("u_preview");
        img.src = URL.createObjectURL(f);
        img.style.display = "block";
      });
      document
        .getElementById("btnSaveUser")
        .addEventListener("click", async () => {
          const form = document.getElementById("formAddUser");
          if (!form.checkValidity()) {
            form.classList.add("was-validated");
            return;
          }
          const file = document.getElementById("u_avatar").files[0];
          let avatar = "";
          if (file) avatar = await fileToDataUrl(file);
          const users = getUsers();
          const id =
            (users.length ? Math.max(...users.map((x) => x.id)) : 0) + 1;
          const u = {
            id,
            name: document.getElementById("u_name").value.trim(),
            email: document.getElementById("u_email").value.trim(),
            role: document.getElementById("u_role").value,
            avatar:
              avatar || "https://cdn-icons-png.flaticon.com/512/147/147144.png",
          };
          users.push(u);
          setUsers(users);
          form.reset();
          document.getElementById("u_preview").style.display = "none";
          alert("User saved");
          showView("users");
        });

      function renderUsers() {
        const users = getUsers();
        const tbody = document.querySelector("#tbl-users tbody");
        tbody.innerHTML = "";
        users.forEach((u) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td>${u.id}</td>
      <td><img src="${u.avatar}" class="user-avatar"></td>
      <td>${u.name}</td>
      <td>${u.email}</td>
      <td>${u.role}</td>
      <td>
        <button class="btn btn-sm btn-outline-danger btn-delete-user" data-id="${u.id}"><i class="bi bi-trash"></i></button>
      </td>
    `;
          tbody.appendChild(tr);
        });
      }

      document.addEventListener("click", (e) => {
        if (e.target.closest(".btn-delete-user")) {
          const id = +e.target.closest("[data-id]").dataset.id;
          if (!confirm("Delete user?")) return;
          setUsers(getUsers().filter((x) => x.id !== id));
          renderUsers();
        }
      });

      /* Notifications */
      document
        .getElementById("sendQuickNotif")
        .addEventListener("click", () => {
          const title = document.getElementById("notif_title").value.trim();
          const msg = document.getElementById("notif_msg").value.trim();
          if (!title || !msg) {
            alert("Add title & message");
            return;
          }
          const notifs = getNotifs();
          const id =
            (notifs.length ? Math.max(...notifs.map((x) => x.id)) : 0) + 1;
          notifs.unshift({ id, title, msg, ts: Date.now() });
          setNotifs(notifs);
          document.getElementById("notif_title").value = "";
          document.getElementById("notif_msg").value = "";
          renderNotifications();
          alert("Notification queued (local)");
        });
      function renderNotifications() {
        const notifs = getNotifs();
        const list = document.getElementById("notifList");
        list.innerHTML = "";
        notifs.forEach((n) => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.innerHTML = `<div class="d-flex justify-content-between"><div><strong>${
            n.title
          }</strong><div class="small-muted">${
            n.msg
          }</div></div><small>${new Date(n.ts).toLocaleString()}</small></div>`;
          list.appendChild(li);
        });
      }

      /* reports - simple counts */
      function renderReports() {
        const events = getEvents();
        const users = getUsers();
        document.getElementById("reportTotal").textContent = events.length;
        document.getElementById("reportUsers").textContent = users.length;
        const cont = document.getElementById("reportsContainer");
        cont.innerHTML = "";
        // simple month counts
        const months = {};
        events.forEach((ev) => {
          const dt = new Date(ev.date);
          const key = dt.toLocaleString("default", {
            month: "short",
            year: "numeric",
          });
          months[key] = (months[key] || 0) + 1;
        });
        for (const [k, v] of Object.entries(months)) {
          const bar = document.createElement("div");
          bar.className = "mb-2";
          bar.innerHTML = `<div class="small-muted">${k} <strong class="float-end">${v}</strong></div>
      <div class="progress" style="height:10px"><div class="progress-bar" role="progressbar" style="width:${Math.min(
        100,
        v * 10
      )}%"></div></div>`;
          cont.appendChild(bar);
        }
      }

      /* settings */
      function loadSettings() {
        const s = getSettings();
        document.getElementById("setting_admin").value = s.adminName || "";
        document.getElementById("setting_theme").value = s.theme || "light";
      }
      document
        .getElementById("btnSaveSettings")
        .addEventListener("click", () => {
          const obj = {
            adminName: document.getElementById("setting_admin").value.trim(),
            theme: document.getElementById("setting_theme").value,
          };
          setSettings(obj);
          alert("Settings saved locally");
        });

      /* calendar generation */
      let calDate = new Date();
      function renderCalendar() {
        const container = document.getElementById("calendarGrid");
        container.innerHTML = "";
        const year = calDate.getFullYear(),
          month = calDate.getMonth();
        document.getElementById("calMonthLabel").textContent =
          calDate.toLocaleString("default", { month: "long", year: "numeric" });
        const first = new Date(year, month, 1);
        const startDay = first.getDay(); // 0..6
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        // add blanks
        for (let i = 0; i < startDay; i++) {
          const blank = document.createElement("div");
          blank.className = "calendar-cell";
          blank.innerHTML = "";
          container.appendChild(blank);
        }
        const events = getEvents();
        for (let d = 1; d <= daysInMonth; d++) {
          const cell = document.createElement("div");
          cell.className = "calendar-cell";
          const dateStr = `${year}-${String(month + 1).padStart(
            2,
            "0"
          )}-${String(d).padStart(2, "0")}`;
          const dayEvents = events.filter((ev) => ev.date === dateStr);
          cell.innerHTML = `<div><strong>${d}</strong></div>`;
          dayEvents.forEach((ev, i) => {
            const dot = document.createElement("div");
            dot.innerHTML = `<span class="dot" style="background:${
              i % 2 ? "#0d6efd" : "#20c997"
            }"></span> ${ev.name}`;
            dot.style.fontSize = ".85rem";
            dot.style.marginTop = "6px";
            cell.appendChild(dot);
          });
          container.appendChild(cell);
        }
      }

      /* simple helpers */
      function fileToDataUrl(file) {
        return new Promise((res, rej) => {
          const r = new FileReader();
          r.onload = () => res(r.result);
          r.onerror = rej;
          r.readAsDataURL(file);
        });
      }

      /* export events */
      document.getElementById("exportEvents").addEventListener("click", () => {
        const data = JSON.stringify(getEvents(), null, 2);
        const blob = new Blob([data], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "events.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      /* calendar nav */
      document.getElementById("prevMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() - 1);
        renderCalendar();
      });
      document.getElementById("nextMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() + 1);
        renderCalendar();
      });

      /* refresh, quick add */
      document.getElementById("refreshBtn").addEventListener("click", () => {
        renderDashboard();
        renderEvents();
        renderUsers();
        renderCalendar();
      });
      document
        .getElementById("quickAddBtn")
        .addEventListener("click", () => showView("add-event"));

      /* notifications page send btn */
      document.getElementById("btnSendNotif").addEventListener("click", () => {
        const title = prompt("Notification title");
        if (!title) return;
        const msg = prompt("Message");
        if (!msg) return;
        const notifs = getNotifs();
        const id =
          (notifs.length ? Math.max(...notifs.map((x) => x.id)) : 0) + 1;
        notifs.unshift({ id, title, msg, ts: Date.now() });
        setNotifs(notifs);
        renderNotifications();
        alert("Notification saved (local)");
      });

      /* render on load */
      showView("dashboard"); // initial
      renderEvents();
      renderUsers();
      renderNotifications();
      renderReports();
      renderCalendar();

      /* restore general click handlers we changed (ensure save uses default after edits) */
      function ensureHandlers() {
        restoreEventSaveHandler();
      }
      ensureHandlers();
    </script>
  </body>
</html>
